<div id="sharing-rules">
  <% if @relationships.present? %>
    <% @relationships.each do |relationship| %>
      <div class="relationship">
        <div class="name">
          <%= "#{relationship.first_name} #{relationship.middle_name} #{relationship.last_name}" %>
        </div>
        <div class="notice">
          <%= relationship.first_name %> can access the following information at the specified trigger points
        </div>
        <div class="sharing-rules">
          <table id="sharing-rules-table-<%= relationship.id %>">
            <% relationship.sharing_rules.each do |sharing_rule| %>
              <%= render :partial => 'sharing_rules_tiny', :locals => { :sharing_rule => sharing_rule, :relationship_id => relationship.id} %>
            <% end %>
          </table>
          <div class="share-more-button" id="share-more-<%= relationship.id %>">
            <%= link_to 'Share More', '' %>
          </div>
        </div>
      </div>

      <script type="text/javascript">
        $(document).ready(function(){
          $('#share-more-<%= relationship.id %>').bind('click', function(){
            $.ajax({
              type: 'GET',
              url: "<%= get_form_tiny_plan_sharing_rules_path(@plan.id) %>",
              data: {plan_id : <%= @plan.id %>, relationship_id : <%= relationship.id %> },
              dataType: "script"
            });
            return false;
          });
        });
      </script>

    <% end %>
  <% end %>

  <div class="add-family-button">
    <%= link_to 'Add Family Member', new_relationship_path %>
  </div>
</div>
